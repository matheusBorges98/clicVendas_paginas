<!DOCTYPE html>  
<html ng-app="appV2">  
<head> 
	<meta charset="utf 8">
	<script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.min.js"></script> 
	<!-- <script
		src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
		integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
		crossorigin="anonymous">
	</script> -->

	<title>CXxxv</title>     
</head>  
<body>
	<div ng-controller="PedidoV2Ctrl">
		<div ng-repeat="produto in listaProd">
			<div>{{produto.desPro}}</div>
		</div>
	</div>

	<h1 ng-controller="teste">{{message}}</h1>
	
	<!-- Regra de negócio -->
	<script type='text/javascript'>
		(function () {
			'use strict';
			angular
				.module("appV2", [])
				.controller("PedidoV2Ctrl", function($scope, $http, $rootScope) {  
					$scope.message2="Controller A";
					
					$scope.executaRequisicaoExterna = async ($json) => {
						try{
							let response = await $http.post(parent.dadosUserLogado().cContextIntegracao + '/rest/Listas/executarRequisicaoExterna', $json)
							
							return response.data
						}catch(response){
							SrvMsg.geraMensagem("erro", "Não foi possível completar a requisição. Por favor, tente novamente mais tarde.")
						}
					};
					
					
					const getListaProduto = async () =>{
						let result = await $scope.executaRequisicaoExterna(
						{
							idCvtccnpj	: parent.dadosUserLogado().cId,
							numreg		: 750, 
							pRotina		: "listarProdutoB2B",
							pCodCli     : 255018,
							pNomPro     : "",
							pTipPro     : "",
						});

						$scope.listaProd = result;
						$scope.$apply();
					};

					getListaProduto();
					
					console.log($scope.listaProd);
				})
				.controller("teste", function($scope){
					$scope.message="Controller B" ;
				})
		})()
	</script> 

</body>  
</html>