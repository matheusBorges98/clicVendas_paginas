<!DOCTYPE html>  
<html ng-app="appV2">  
<head> 
	<meta charset="utf 8">
<!-- Imports CSS-->

	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/bootstrap.min.css">
	<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"> <!-- Icones -->
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/jquery.dataTables.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/angular-datatables.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/dataTables.colVis.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/dataTables.tableTools.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/buttons.dataTables.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/datatables.bootstrap.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/isteven-multi-select.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/font-awesome/css/all.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/buttons.dataTables.min.css">
<!-- Imports CSS-->

<!-- View --> 
</head>  
<body>
	<div>
		<div ng-controller="MainController">

			<div ng-show="exibeFormulario" class="container col-sm-12">
				<button class="btn btn_acao_header btn_cor_padrao" ng-click="listarDocumentos()"> Listar </button>

				<!-- Header formulario -->
				<div class="divider-titulo col-sm-12">
					<div class="spacer titulo vcenter">
						Novo pedido
					</div>			
				</div>
				<!-- Header formulario -->
				
				<!-- Capa do pedido -->
				<div class="row spacer">
					
					<div class="col-sm-12">

						<!-- Body formulario -->
						<div class="col-sm-4 spacer">
							<label>Tipo venda:</label>	
							<div class="input-group">
								<input 
									type="text" 
									ng-model="frmTipoVenda"
									id="frmTipoVenda" 
									placeholder="Informe o tipo de venda" 
									uib-typeahead="tpv.tipoVenda for tpv in getTipoPedido($viewValue)" 
									typeahead-on-select="onSelectTipoPedido($item, $model, $label)" 
									class="form-control" 
									required="true" 
									autocomplete="off" 
									typeahead-min-length="0" 
								>
								<span class="input-group-addon" style="cursor: pointer;" ng-click="limpaTipoPedido()"><i class="glyphicon glyphicon-remove"></i></span>  
							</div>
							<i ng-show="loadingFrmTipoVenda" class="glyphicon glyphicon-refresh"></i>
						</div>

						<div class="col-sm-4 spacer">
							<label>Tabela de preço:</label>	
							<input type="text" placeholder="Informe a tabela de preço" class="form-control" ng-model="tabelaPreco">
						</div>

						<div class="col-sm-4 spacer">
							<label>Cliente</label>	
							<input type="text" placeholder="Informe o cliente" class="form-control" ng-model="cliente">
						</div>

						<div class="col-sm-4 spacer">
							<label>Endereço de entrega</label>	
							<input type="text" placeholder="Informe o endereço de entrega" class="form-control" ng-model="endEntrega">
						</div>
						
						<div class="col-sm-4 spacer">
							<label>Previsão entrega</label>	
							<input type="text" placeholder="Informe a previsão de entrega" class="form-control" ng-model="prevEntrega">
						</div>

						<div class="form-group col-md-12  col-sm-12 spacer">
							<label for="frmObservacao">Descrição: <span ng-show="frmOrcamentoEmail.frmObservacao.$error.required" style="color: red">*</span></label>
							<textarea class="form-control" rows="3" id="frmObservacao" ng-model="frmObservacao" name="frmObservacao" ng-trim="false" maxlength="249"></textarea>
							<span>Restam {{249 - frmObservacao.length}} caracteres.</span>
						</div>
				
					</div>		

				</div>
				<!-- Capa do pedido -->
				<hr class="divider">

				<div class="row spacer">
					<div class="col-sm-12">
						<h1>TESTE</h1>
						<h1>TESTE</h1>
						<h1>TESTE</h1>
						<h1>TESTE</h1>
					</div>
				</div>
				
				<hr class="divider">
				<!-- Ações sob o formulario -->
				<div class="row spacer">
					<div class="pull-right" style="padding-right: 10px;">
						<div class="btn-group">
							<button class="btn btn_grid btn_cor_padrao" ng-click="listarDocumentos()"> Cancelar </button>
						</div>
						<div class="btn-group">
							<button class="btn btn_grid btn_cor_padrao" ng-click="salvarForm()"> Salvar </button>
						</div>	
					</div>
				</div>
			
				<hr class="divider">				

			</div>
		</div>

		<div ng-controller="ColumnsController">			
			<!-- Listagem de documentos na tabela  -->
			<div ng-show="exibeListaDocumentos">
				<table id="gridPedidoV2" dt-options="dtOptions" dt-columns="dtColumns" dt-instance="dtInstance" class="row-border hover table-striped table-bordered"/>
			</div>
			<!-- Listagem de documentos na tabela  -->
		</div>
	</div>
<!-- View --> 

<!-- Scripts importados -->
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/jquery-3.1.1.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/easytimer.min.js"></script>	
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-route.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-ui-router.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-cookies.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angular-ui-notification/angular-ui-notification.min.js"></script>  
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/ui-bootstrap-tpls-2.5.0.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/dist/jquery.dataTables.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/dist/angular-datatables.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/bootstrap.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.bootstrap.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.factory.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.options.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/dataTables.buttons.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.colVis.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.flash.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.html5.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.print.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.buttons.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-locale_pt-br.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-sanitize.min.js"></script>
<!-- Scripts importados -->	
</body>  
</html>

<!-- Regra de negócio -->
<script>	
!function(){angular.module("appV2",["ngRoute","ngSanitize","ui.bootstrap","datatables","datatables.buttons"]);var a=angular.module("appV2");a.controller("MainController",function(a,o,e,t){e.exibeFormulario=!1,e.exibeListaDocumentos=!0,e.listarDocumentos=(()=>{e.exibeListaDocumentos=!0,e.exibeFormulario=!1,e.getListaDocumentos()}),a.executaRequisicaoExterna=(async a=>{try{let e=await o.post(parent.dadosUserLogado().cContextIntegracao+"/rest/Listas/executarRequisicaoExterna",a);return e.data}catch(a){SrvMsg.geraMensagem("erro","Não foi possível completar a requisição. Por favor, tente novamente mais tarde.")}}),e.getListaDocumentos=(async()=>{console.log("a");let o=await a.executaRequisicaoExterna({idCvtccnpj:parent.dadosUserLogado().cId,numreg:750,pRotina:"listarProdutoB2B",pCodCli:parent.dadosUserLogado().rId,pNomPro:"",pTipPro:""});console.log(o),a.listaDocs=o,a.$apply()}),a.getTipoPedido=function(t){return o.post("/clicVendas/rest/Listas/tipoPedido",{params:{filtro:t||"",idCvTccnpj:parent.dadosUserLogado().cId}}).then(function(o){return 1==o.data.length&&(e.objVenda.tipoVenda=o.data[0],a.frmTipoVenda=o.data[0].tipoVenda),o.data.map(function(a){return a})})},a.limpaTipoPedido=function(){a.frmTipoVenda="",e.objVenda.tipoVenda=null;let o=angular.element(document.querySelector("#frmTipoVenda"));t(function(){o.focus()},200)},a.onSelectTipoPedido=function(a,o,t){e.objVenda.tipoVenda=a},e.salvarForm=(()=>{console.log(e.objVenda);let o={tipoVenda:a.tipoVenda,tabelaPreco:a.tabelaPreco,cliente:a.cliente,endEntrega:a.endEntrega,prevEntrega:a.prevEntrega,frmObservacao:a.frmObservacao};console.log(o)})}),a.controller("ColumnsController",function(a,o,e,t,i,n,r,d,s,l){var c=this;n.abreFormPedido=(a=>{delete n.objVenda,n.ehNovoPedido=!1,angular.isDefined(a)?d({method:"POST",url:"/clicVendas/rest/pedido/consulta/"+a,data:{idCvTccnpj:parent.dadosUserLogado().cId}}).then(function(a){"ERRO"==a.resultado?console.log(a.data.resultado,a.data.mensagem):(n.objVenda=a.data.parametros.venda,n.idPedido=n.objVenda.id)},function(a){console.log("critica","Não foi possível carregar o pedido. Tente novamente mais tarde. ")}):(n.ehNovoPedido=!0,n.idPedido=0,n.objVenda={}),n.exibeListaDocumentos=!1,n.exibeFormulario=!0,console.log(n.objVenda),i.$apply()}),t.setLanguageSource("plugins/pt-br.json"),console.log(parent.dadosUserLogado());d({url:"/clicVendas/rest/Listas/listaColunasGrid",method:"POST",data:{cId:parent.dadosUserLogado().cId,idGrid:3}}).then(function(o){i.dtOptions=a.newOptions().withOption("ajax",{url:"/clicVendas/rest/pedido/lista",type:"POST",data:function(a){var o={idGrid:3};a.parametros=o;var e={dtEmissaoInicio:angular.isUndefined(n.dtEmissaoInicio)||null==n.dtEmissaoInicio?"":n.dtEmissaoInicio.toLocaleDateString(),dtEmissaoFim:angular.isUndefined(n.dtEmissaoFim)||null==n.dtEmissaoFim?"":n.dtEmissaoFim.toLocaleDateString(),dtPrevisaoInicio:angular.isUndefined(n.dtPrevisaoInicio)||null==n.dtPrevisaoInicio?"":n.dtPrevisaoInicio.toLocaleDateString(),dtPrevisaoFim:angular.isUndefined(n.dtPrevisaoFim)||null==n.dtPrevisaoFim?"":n.dtPrevisaoFim.toLocaleDateString(),idCvtccnpj:angular.isUndefined(parent.dadosUserLogado().cId)?0:parent.dadosUserLogado().cId,rId:parent.dadosUserLogado().rId,rTipoId:parent.dadosUserLogado().rTipoId,listaStatusPed:n.statusPedSel,listaFilSincronizacao:n.filSincronizacaoSel,listaTipoPed:n.tipoPedSel,filEhOrcamento:n.filEhOrcamento,listaFiltroRamoAtividade:n.filRamoAtividade,listaFiltroOrigem:n.filOrigem};return a.filtros=e,JSON.stringify(a)}}).withDataProp("data").withOption("processing",!0).withOption("serverSide",!0).withOption("searchDelay",1e3).withOption("scrollY","100%").withPaginationType("full_numbers").withDisplayLength(20).withDOM('<"toolbar">ftrip').withButtons([{text:"Novo",key:"1",className:"btn_grid btn_cor_padrao",action:function(a,o,e,t){n.usarItensCarrinho=!1,i.dadosExternosNovoPedido="undefined",n.abreFormPedido()}},{text:"Filtrar",key:"2",className:"btn_grid btn_cor_padrao",action:function(a,o,e,t){c.abreModalFiltro()}},{text:"Atualizar",key:"4",className:"btn_grid btn_cor_padrao",action:function(a,o,e,t){c.atualizarPedidos()}}]);var e=o.data.columns;i.dtColumns=e,angular.forEach(i.dtColumns,function(a,o){switch(a.data){case"tipoVenda":e[o].mRender=function(a,o,e){return null!=e.tipoVenda?e.tipoVenda.tipoVenda:""};break;case"dataEmissao":e[o].mRender=function(a,o,e){return e.dataEmissaoFormat};break;case"previsaoEntrega":e[o].mRender=function(a,o,e){return e.previsaoEntregaFormat};break;case"totalVenda":e[o].mRender=function(a,o,e){return e.totalVendaFormat};break;case"origem":e[o].mRender=function(a,o,e){return e.origem};break;case"ramoAtividade":e[o].mRender=function(a,o,e){return e.ramoAtividade}}}),i.dtOptions.withOption("order",o.data.order),angular.element("#gridPedidoV2").attr("datatable",""),r(angular.element("#gridPedidoV2"))(i),i.dtOptions.withOption("fnRowCallback",function(a,o,e,t){r(a)(i)})})}),a.controller("UtilsController",function(a,o,e){})}();
</script> 
				
<style>
	:root {
			--cor_principal: #047cca;
	}
				
	.btn_grid{
		background-image: none !important;
		color: #fff !important;
		font-weight: 600;
	}

	.btn_acao_header{
		background-image: none !important;
		color: #fff !important;
		font-weight: 600;
		width: 80px;
		height: 35px;
		font-size: 0.88em;
	}

	.btn_cor_padrao {
		background-color: var(--cor_principal) !important;
		border-color: var(--cor_principal) !important; 
	}

	.container{
		height: calc(100% - 40px); 
		position: relative;
	}

	.divider{
		border-top: 1px solid #bbb;
	}
	
	.divider-titulo{
		border-top: 0.8px solid #bbb;
		border-bottom: 0.8px solid #bbb;
		height: 50px;
		margin-top: 5px;
	}

	.spacer{
		margin-top:20px;
	}

	.titulo{
		font-size: 15px;
		font-weight: 900;
	}

	.vcenter {
		display: flex;
		align-items: center;
	}
	
</style>