<!DOCTYPE html>  
<html ng-app="appV2">  
<head> 
	<meta charset="utf-8"/>
	<!-- Imports CSS-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/jquery.dataTables.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/angular-datatables.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/dataTables.colVis.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/dataTables.tableTools.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/buttons.dataTables.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/datatables.bootstrap.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/isteven-multi-select.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/font-awesome/css/all.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/buttons.dataTables.min.css">
	<!-- Imports CSS-->

<!-- View --> 
</head>  
<body>
	<div class="container" ng-controller="MainController">
		
		<!--Primeira página-->
		<div ng-show="exibeListaDocumentos">
		
			<!-- Sidebar Menu FILTRO -->
			<div id="mySidebar" class="sidebar">
				<form>
					<div class="form-group">
						<label for="filFornecedores">Fornecedor</label>
						<input type="text" style="width: 220px;" class="form-control" id="filFornecedores" ng-model="filFornecedores" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCliente">Cliente</label>
						<input type="text" style="width: 220px;" class="form-control" id="filCliente" ng-model="filCliente" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filBU">BU</label>
						<input type="text" style="width: 220px;" class="form-control" id="filBU" ng-model="filBU" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCluster">Cluster</label>
						<input type="text" style="width: 220px;" class="form-control" id="filCluster" ng-model="filCluster" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filStatusAmostra">Status da Amostra</label>
						<input type="text" style="width: 220px;" class="form-control" id="filStatusAmostra" ng-model="filStatusAmostra" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Carteira</label>
						<input type="text" style="width: 220px;" class="form-control" id="filCarteira" ng-model="filCarteira" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Data Envio</label>
						<input type="date" style="width: 75px;" class="form-control" id="filDataEnvio" ng-model="filDataEnvio" aria-describedby=" " placeholder="In�cio">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Data Solicitação</label>
						<input type="text" style="width: 75px;" class="form-control" id="filDataSolicitacao" ng-model="filDataSolicitacao" aria-describedby=" " placeholder="Fim">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Segmento</label>
						<input type="text" style="width: 220px;" class="form-control" id="filSegmento" ng-model="filSegmento" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">SubSegmento</label>
						<input type="text" style="width: 220px;" class="form-control" id="filSubSegmento" ng-model="filSubSegmento" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Prioridade</label>
						<input type="text" style="width: 220px;" class="form-control" id="filPrioridade" ng-model="filPrioridade" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Produto</label>
						<input type="text" style="width: 220px;" class="form-control" id="filProduto" ng-model="filProduto" aria-describedby=" " placeholder=" ">
					</div>
				</form>
			</div>
			<!--Sidebar Menu FILTRO-->
		
			<!-- Tabela -->
			<div id="main">
				<div class="col-sm-12">
					<table id="listDocuments"  dt-options="dtOptions" dt-columns="dtColumns" dt-instance="dtInstance" class="row-border hover table-striped table-bordered"></table>					
				</div>
			</div>
			<!-- Tabela -->
		
		</div>
		<!--Primeira página-->

		<!-- FORM NOVO DOCUMENTO -->

		<div ng-show="exibeFormulario">
			<button class="btn btn_acao_header btn_cor_padrao" ng-click="changeView()"> Voltar </button>

			<!-- Header formulario -->
			<div class="divider-titulo col-sm-12">
				<div class="spacer titulo vcenter">
					{{tipoFormulario}}
				</div>			
			</div>
			<!-- Header formulario -->
			
			<!-- Capa do pedido -->
			<div class="row spacer">
				
				<div class="col-sm-12">

					<!-- Body formulario -->
					<div class="form-row">
						<div class="form-group col-md-12">
							<div class="col-sm-2 spacer">
								<label for="chave">Chv.(Cli-Prod-Ped)</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="chave" id="chave">
							</div>
							<div class="col-sm-2 spacer">
								<label for="ano">Ano</label>
								<input type="date" ng-disabled="inputDesabilitado" class="form-control" ng-model="ano" id="ano">
							</div>
							<div class="col-sm-3 spacer">
								<label for="responsavel">Responsável</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="responsavel" id="responsavel">
							</div>
							<div class="col-sm-2 spacer">
								<label for="projeto">Projeto</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="projeto" id="projeto">
							</div>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group col-md-12">
							<div class="col-sm-3 spacer">
								<label for="vendedor">Vendedor</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="vendedor" id="vendedor">
							</div>
							<div class="col-sm-2 spacer">
								<label for="codigoCliente">Cód. do Cliente</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="codigo" id="codigoCliente">
							</div>
							<div class="col-sm-6 spacer">
								<label for="nomeCliente">Nome do Cliente</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="nomeCliente" id="nomeCliente">
							</div>
							<div class="col-sm-1 spacer">
								<label for="uf">UF</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="uf" id="uf">
							</div>
							<div class="col-sm-3 spacer">
								<label for="segmento">Segmento</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="segmento" id="segmento">
							</div>
							<div class="col-sm-3 spacer">
								<label for="subsegmento">Subsegmento</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="subsegmento" id="subsegmento">
							</div>
							<div class="col-sm-3 spacer">
								<label for="bu">BU</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="bu" id="bu">
							</div>
							<div class="col-sm-3 spacer">
								<label for="aplicacao">Aplicação</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="aplicacao" id="aplicacao">
							</div>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group col-md-12">
							<div class="col-sm-2 spacer">
								<label for="pedido">Pedido</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="pedido" id="pedido">
							</div>
							<div class="col-sm-2 spacer">
								<label for="emissao">Emissão</label>
								<input type="date" ng-disabled="inputDesabilitado" class="form-control" ng-model="emissao" id="emissao">
							</div>
							<div class="col-sm-4 spacer">
								<label for="familia">Familia</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="familia" id="familia">
							</div>
							<div class="col-sm-4 spacer">
								<label for="cluster">Cluster</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="cluster" id="cluster">
							</div>
							<div class="col-sm-2 spacer">
								<label for="codPro">Cód. Produto</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="codigo" id="codPro">
							</div>
							<div class="col-sm-4 spacer">
								<label for="despro">Descrição</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="descricao" id="despro">
							</div>
							<div class="col-sm-2 spacer">
								<label for="desagr">Ag. Comercial</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="desagr" id="desagr">
							</div>
							<div class="col-sm-2 spacer">
								<label for="quantidadeKg">Qtde (kg)</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="quantidadeKg" id="quantidadeKg">
							</div>
							<div class="col-sm-2 spacer">
								<label for="dataStatus">Data Status</label>
								<input type="date" ng-disabled="inputDesabilitado" class="form-control" ng-model="dataStatus" id="dataStatus">
							</div>
							<div class="col-sm-2 spacer">
								<label for="situacao">Situação Amostra</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="situacao" id="situacao">
							</div>
							<div class="col-sm-2 spacer">
								<label for="consumo">Consumo (Kg/mês)</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="consumo" id="consumo">
							</div>
							<div class="col-sm-8 spacer">
								<label for="justificativa">Justificativa</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="justificativa" id="justificativa">
							</div>							
						</div>	
					</div>
					
					<div class="form-row">
						<div class="form-group col-md-12">
							<div class="col-sm-2 spacer">
								<label for="consumoAg">Consumo Ano Gerencial</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="consumoAg" id="consumoAg">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="con2021Ident">Con. 2021 ident</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="con2021Ident" id="con2021Ident">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="con2021n">Con. 2021 (em nº)</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="con2021n" id="con2021n">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="con2022n">Con. 2022 (em nº)</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="con2022n" id="con2022n">
							</div>

							<div class="col-sm-2 spacer">
								<label for="prioridade">Prioridade</label>
								<input type="text" class="form-control" ng-model="prioridade" id="prioridade" >
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="potencial">Potencial</label>
								<input type="text" class="form-control" ng-model="potencial" id="potencial" >
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="con2022Local">Consumo 2022 kg/ano</label>
								<input type="text" class="form-control" ng-model="con2022Local" id="con2022Local" >
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="probFechamento">% Prob. Fec.</label>
								<input type="text" class="form-control" ng-model="probFechamento" id="probFechamento" >
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="concorrencia">Concorrência</label>
								<input type="text" class="form-control" ng-model="concorrencia" id="concorrencia" >
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="precoConc">Preço Conc. US$</label>
								<input type="text" class="form-control" ng-model="precoConc" id="precoConc" >
							</div>
						</div>
					</div>

					<div class="form-row">
						<div class="form-group col-md-12">
							<div class="col-sm-8 spacer">
								<label for="acoes">Ações</label>
								<input type="text" class="form-control" ng-model="acoes" id="acoes" >
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="statusAcao">Status da Ação</label>
								<input type="text" class="form-control" ng-model="statusAcao" id="statusAcao" >
							</div>			   
							<div class="col-sm-2 spacer">
								<label for="dataAtu">Data Atualização</label>
								<input type="date" class="form-control" ng-model="dataAtu" id="dataAtu" >
							</div>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group col-md-12">
							<div class="col-sm-2 spacer">
								<label for="ofertaData">OFERTA Data</label>
								<input type="date" ng-disabled="inputDesabilitado" class="form-control" ng-model="ofertaData" id="ofertaData">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="ofertaUnit">OFERTA Unit. (US$)</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="ofertaUnit" id="ofertaUnit">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="potencial0XCM">Potencial OxCM</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="potencial0XCM" id="potencial0XCM">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="chaveCp">Chave CP</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="chaveCp" id="chaveCp">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="venda">INDENT Qtde</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="identQtd" id="identQtd">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="venda">Venda</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="venda" id="venda">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="vendaLocalKg">Venda Local (KG)</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="vendaLocalKg" id="vendaLocalKg">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="ultVendaTabdin">Últ. Venda TABDIN</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="ultVendaTabdin" id="ultVendaTabdin">
							</div>
							<div class="col-sm-2 spacer">
								<label for="primVendaTabdin">1.a Venda TABDIN</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="primVendaTabdin" id="primVendaTabdin">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="anoPrimVenda">ANO 1.a VENDA</label>
								<input type="date" ng-disabled="inputDesabilitado" class="form-control" ng-model="anoPrimVenda" id="anoPrimVenda">
							</div>
							<div class="col-sm-2 spacer">
								<label for="totalFatUSD">Tot. Fat. (USD)</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="totalFatUSD" id="totalFatUSD">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="margemR">Margem (R$)</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="margemR" id="margemR">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="preUSD">Pre. USD</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="preUSD" id="preUSD">
							</div>			  
							<div class="col-sm-2 spacer">
								<label for="potVolAg">Pot. Vol. AG</label>
								<input type="text" ng-disabled="inputDesabilitado" class="form-control" ng-model="potVolAg" id="potVolAg">
							</div>
						</div>
					</div>
				</div>	
					
			</div>
			<!-- Capa do pedido -->
						
			<hr class="divider">
			<!-- Ações sob o formulario -->
			<div class="row spacer">
				<div class="pull-right" style="padding-right: 10px;">
					<div class="btn-group">
						<button class="btn btn_grid btn_cor_padrao" ng-click="changeView()"> Cancelar </button>
					</div>
					<div class="btn-group">
						<button class="btn btn_grid btn_cor_padrao" ng-click="salvarDocumento()"> Salvar </button>
					</div>	
				</div>
			</div>
			<!-- Ações sob o formulario -->
			<hr class="divider">	

		</div>
	
	</div>
	<!-- View --> 


<!-- Scripts importados -->
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/jquery-3.1.1.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/easytimer.min.js"></script>	
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-route.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-ui-router.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-cookies.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angular-ui-notification/angular-ui-notification.min.js"></script>  
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/ui-bootstrap-tpls-2.5.0.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/dist/jquery.dataTables.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/dist/angular-datatables.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/bootstrap.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.bootstrap.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.factory.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.options.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/dataTables.buttons.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.colVis.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.flash.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.html5.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.print.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.buttons.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-locale_pt-br.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-sanitize.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
<!-- Scripts importados -->	

<script>
var dadosUserLogado = parent.dadosUserLogado();	

angular
	.module("appV2",['ngRoute', 'ngSanitize', 'ui.bootstrap', 'datatables', 'datatables.buttons'])
	.controller("MainController",
	function(DTOptionsBuilder, DTColumnDefBuilder, DTColumnBuilder, DTDefaultOptions, $scope, $rootScope, $compile, $http, $timeout, $window){
		
		$scope.exibeFormulario 		= false; 
		$scope.exibeListaDocumentos = true; 

		$rootScope.changeView = ($dados) => {
			if($scope.exibeFormulario == false){

				$scope.exibeFormulario = true;
				$scope.exibeListaDocumentos = false;
				
				if($dados == undefined){
					$scope.tipoFormulario = "Novo";
					$scope.inputDesabilitado  = false;
					
					$scope.$apply()
				}else{
					$scope.tipoFormulario = "Edição";
					$scope.inputDesabilitado  = true;
				}
				
			}else if($scope.exibeFormulario == true){

				$scope.exibeFormulario = false;
				$scope.exibeListaDocumentos = true;
			};

		};
						
		$scope.executaRequisicaoExterna = async ($json) => {
			try{
				let response = await $http.post(dadosUserLogado.cContextIntegracao + '/rest/Listas/executarRequisicaoExterna', $json);
				
				return response.data;
			}catch(response){
				console.log("erro", "Não foi possível completar a requisição. Por favor, tente novamente mais tarde.");
			};
		};
		
		$scope.getListaDocumentos = async () =>{
			let result = await $scope.executaRequisicaoExterna(
			{
				idCvtccnpj	: dadosUserLogado.cId,
				numreg		: 750, 
				pRotina		: "listarProdutoB2B",
				pCodCli     : dadosUserLogado.rId,
				pNomPro     : "",
				pTipPro     : "",
			});

			console.log(result);
			$scope.listaDocs = result;
			$scope.$apply();
		};

		$scope.abreFormulario = ($dados) =>{

			$rootScope.idDocumento = $dados !=undefined ? $dados.id : 0;

			if($dados == undefined){
				$rootScope.idDocumento = 0;
				
				$scope.chave 			= '';
				$scope.ano 				= '';
				$scope.responsavel		= '';
				$scope.projeto			= '';
				$scope.codigo			= '';
				$scope.nomeCliente		= '';
				$scope.uf				= '';
				$scope.vendedor			= '';
				$scope.segmento			= '';
				$scope.subsegmento		= '';
				$scope.bu				= '';
				$scope.aplicacao		= '';
				$scope.emissao			= '';
				$scope.pedido			= '';
				$scope.familia			= '';
				$scope.cluster			= '';
				$scope.codigo			= '';
				$scope.descricao		= '';
				$scope.desagr			= '';
				$scope.dataStatus		= '';
				$scope.quantidadeKg		= '';
				$scope.situacao			= '';
				$scope.justificativa	= '';
				$scope.consumo			= '';
				$scope.prioridade		= '';
				$scope.consumoAg		= '';
				$scope.con2021Ident		= '';
				$scope.con2021n			= '';
				$scope.con2022n			= '';
				$scope.con2022Local		= '';
				$scope.probFechamento	= '';
				$scope.concorrencia		= '';
				$scope.precoConc		= '';
				$scope.dataAtu			= '';
				$scope.ofertaData		= '';
				$scope.ofertaUnit		= '';
				$scope.potencial0XCM	= '';
				$scope.chaveCp			= '';
				$scope.identQtd			= '';
				$scope.venda			= '';
				$scope.vendaLocalKg		= '';
				$scope.totalFatUSD		= '';
				$scope.margemR			= '';
				$scope.preUSD			= '';
				$scope.potVolAg			= '';
				$scope.ultVendaTabdin	= '';
				$scope.primVendaTabdin	= '';
				$scope.anoPrimVenda		= '';
				$scope.statusAcao		= '';
				$scope.acoes			= '';
			}else{

				let docs 				=  JSON.parse($dados.jsonDocs);
				$rootScope.idDocumento 	= $dados.id;

				$scope.chave 			= docs.chave
				$scope.ano 				= docs.ano != "" ? new Date(docs.ano) : "";
				$scope.responsavel		= docs.responsavel;
				$scope.projeto			= docs.projeto;
				$scope.codigo			= docs.codigo;
				$scope.nomeCliente		= docs.nomeCliente;
				$scope.uf				= docs.uf;
				$scope.vendedor			= docs.vendedor;
				$scope.segmento			= docs.segmento;
				$scope.subsegmento		= docs.subsegmento;
				$scope.bu				= docs.bu;
				$scope.aplicacao		= docs.aplicacao;
				$scope.emissao			= docs.emissao != "" ? new Date(docs.emissao) : "";
				$scope.pedido			= docs.pedido;
				$scope.familia			= docs.familia;
				$scope.cluster			= docs.cluster;
				$scope.codigo			= docs.codigo;
				$scope.descricao		= docs.descricao;
				$scope.desagr			= docs.desagr;
				$scope.dataStatus		= docs.dataStatus != "" ? new Date(docs.dataStatus) : "";
				$scope.quantidadeKg		= docs.quantidadeKg;
				$scope.situacao			= docs.situacao;
				$scope.justificativa	= docs.justificativa;
				$scope.consumo			= docs.consumo;
				$scope.prioridade		= docs.prioridade;
				$scope.consumoAg		= docs.consumoAg;
				$scope.con2021Ident		= docs.con2021Ident;
				$scope.con2021n			= docs.con2021n;
				$scope.con2022n			= docs.con2022n;
				$scope.con2022Local		= docs.con2022Local;
				$scope.probFechamento	= docs.probFechamento;
				$scope.concorrencia		= docs.concorrencia;
				$scope.precoConc		= docs.precoConc;
				$scope.dataAtu			= docs.dataAtu != "" ? new Date(docs.dataAtu) : "";
				$scope.ofertaData		= docs.ofertaData != "" ? new Date(docs.ofertaData) : "";
				$scope.ofertaUnit		= docs.ofertaUnit;
				$scope.potencial0XCM	= docs.potencial0XCM;
				$scope.chaveCp			= docs.chaveCp;
				$scope.identQtd			= docs.identQtd;
				$scope.venda			= docs.venda;
				$scope.vendaLocalKg		= docs.vendaLocalKg;
				$scope.totalFatUSD		= docs.totalFatUSD;
				$scope.margemR			= docs.margemR;
				$scope.preUSD			= docs.preUSD;
				$scope.potVolAg			= docs.potVolAg;
				$scope.ultVendaTabdin	= docs.ultVendaTabdin;
				$scope.primVendaTabdin	= docs.primVendaTabdin;
				$scope.anoPrimVenda		= docs.anoPrimVenda != "" ? new Date(docs.anoPrimVenda) : "";
				$scope.statusAcao		= docs.statusAcao;
				$scope.acoes			= docs.acoes;
			}

			$rootScope.changeView($dados);

			console.log($dados);

		};

		$scope.salvarDocumento = async () => {
			
			let id 			= $rootScope.idDocumento;
			let jsonDocs	= {};
			let dados 		= {};

			dados.cnpj 		= {id: dadosUserLogado.cId};

			jsonDocs = {
				chave 			: $scope.chave,
				ano	  			: $scope.ano,
				responsavel		: $scope.responsavel,
				projeto     	: $scope.projeto,
				codigo			: $scope.codigo,
				nomeCliente 	: $scope.nomeCliente,
				uf 				: $scope.uf,
				vendedor		: $scope.vendedor,
				segmento		: $scope.segmento,
				subsegmento 	: $scope.subsegmento,
				bu 				: $scope.bu,
				aplicacao		: $scope.aplicacao,
				emissao			: $scope.emissao,
				pedido			: $scope.pedido,
				familia			: $scope.familia,
				cluster			: $scope.cluster,
				codigo			: $scope.codigo,
				descricao		: $scope.descricao,
				desagr			: $scope.desagr,
				dataStatus		: $scope.dataStatus,
				quantidadeKg	: $scope.quantidadeKg,
				situacao		: $scope.situacao,
				justificativa	: $scope.justificativa,
				consumo			: $scope.consumo,
				prioridade		: $scope.prioridade,
				consumoAg		: $scope.consumoAg,
				con2021Ident	: $scope.con2021Ident,
				con2021n		: $scope.con2021n,
				con2022n		: $scope.con2022n,
				con2022Local	: $scope.con2022Local,
				probFechamento	: $scope.probFechamento,
				concorrencia	: $scope.concorrencia,
				precoConc		: $scope.precoConc,
				dataAtu			: $scope.dataAtu,
				ofertaData		: $scope.ofertaData,
				ofertaUnit		: $scope.ofertaUnit,
				potencial0XCM	: $scope.potencial0XCM,
				chaveCp			: $scope.chaveCp,
				identQtd		: $scope.identQtd,
				venda			: $scope.venda,
				vendaLocalKg	: $scope.vendaLocalKg,
				totalFatUSD		: $scope.totalFatUSD,
				margemR			: $scope.margemR,
				preUSD			: $scope.preUSD,
				potVolAg		: $scope.potVolAg,
				ultVendaTabdin  : $scope.ultVendaTabdin,
				primVendaTabdin : $scope.primVendaTabdin,
				anoPrimVenda	: $scope.anoPrimVenda,
				statusAcao		: $scope.statusAcao,
				acoes			: $scope.acoes,
			};

			dados.jsonDocs = JSON.stringify(jsonDocs);
		
			try{
				if(id > 0){
					let response = await $http.post('/clicVendas/rest/pedidov2/salvar/'+id, dados);
				}else{
					let response = await $http.post('/clicVendas/rest/pedidov2/salvar/', dados);
				}
			}catch(err){
				console.log(err);
			}

			$scope.exibeFormulario = false;
			$scope.exibeListaDocumentos = true;
			$scope.atualizaTabela();
		};
		
		/*Define o idioma usado no Datatables*/
		$scope.atualizaTabela = (modo) =>{

			$scope.dtOptions = DTOptionsBuilder.newOptions()            
			.withOption('ajax', {
				url	: '/clicVendas/rest/pedidov2/lista',
				type	: 'POST',
				data	: function(d) {   
							var param = {idCvTccnpj	: dadosUserLogado.cId};
							d.param = param;
							console.log(JSON.stringify(d), "data")
							return JSON.stringify(d);
						}
				})
					.withDataProp('data')
					.withOption('processing', true)
					.withOption('serverSide', true)
					.withOption('searchDelay', 1000)
					.withOption('scrollY', "100%")            
					.withPaginationType('full_numbers')            
					.withDisplayLength(20)
					.withDOM('ftrip')
					.withButtons([
				{
					enabled: dadosUserLogado.params.paramPermiteCadastrarPedido == 'S',
					text: 'Novo',
					key: '1',
					className: 'btn_grid btn_cor_padrao',
					action: function (e, dt, node, config) {									
						$scope.abreFormulario();					
					}
				},		
				{
					text: 'Filtrar',
					key: '2',
					className: 'btn_grid btn_cor_padrao',
					action: function (e, dt, node, config) {									
						openNav();					
					}
				},		
				{
					text: modo == 'completa' ? 'Tabela Simplificada' :'Tabela Completa',
					key: '3',
					className: 'btn_grid btn_cor_padrao',
					action: function () {									
						modo == 'completa' ? $scope.mostraTabelaSimplificada() : $scope.mostraTabelaCompleta();					
					}
				},								
			]);	
			
			if(modo == "completa"){
				defPD = {'id'			:	{i:0, vsbl: false,	tlt: '',        		width:''	},
						'jsonDocs'		:	{i:1, vsbl: true,	tlt: 'Cliente',			width:''	},
						'jsonDocs'		:	{i:2, vsbl: false,	tlt: 'Fornecedor',		width:''	},
						'jsonDocs'		:	{i:3, vsbl: false,	tlt: 'Produto',			width:''	},
						'jsonDocs'		:	{i:4, vsbl: false,	tlt: 'Aplicação',		width:''	},
						'jsonDocs'		:	{i:5, vsbl: false,	tlt: 'Status Amostra',	width:''	},
						'jsonDocs'		:	{i:6, vsbl: false,	tlt: 'Prioridade',		width:''	}	
						};
		
			}else{
				defPD = {'id'			:	{i:0, vsbl: true,	tlt: 'TESTE',        	width:''	},
						'jsonDocs'		:	{i:1, vsbl: true,	tlt: 'Cliente',			width:''	},
						'jsonDocs'		:	{i:2, vsbl: true,	tlt: 'Fornecedor',		width:''	},
						'jsonDocs'		:	{i:3, vsbl: true,	tlt: 'Produto',			width:''	},
						'jsonDocs'		:	{i:4, vsbl: true,	tlt: 'Aplicação',		width:''	},
						'jsonDocs'		:	{i:5, vsbl: true,	tlt: 'Status Amostra',	width:''	},
						'jsonDocs'		:	{i:6, vsbl: true,	tlt: 'Prioridade',		width:''	}	
					};
		
			}
			DTDefaultOptions.setLanguageSource('plugins/pt-br.json');
			var montaColunas = [];
			
			montaColunas.push(DTColumnBuilder.newColumn(null).withTitle('').withOption('sortable', false).withClass("colBtn").withOption('sWidth', '50px').renderWith(function(data, type, row) {
				var btnhtml = "";				
				btnhtml += "<div class='glyphicon glyphicon-edit' style='font-size:1.5em; color:var(--cor_principal);  display:inline-block; vertical-align: middle; cursor:pointer;' title='Editar' ng-click='abreFormulario("+JSON.stringify(row)+")'></div>";
				btnhtml += "<div class='glyphicon glyphicon-ban-circle' style='font-size:1.5em; padding-left:4px; color:var(--cor_principal); display:inline-block; vertical-align: middle; cursor:pointer;' title='Cancelar item' ng-click='removerDocumento("+JSON.stringify(row)+")' ></div>";
				return btnhtml;
			}));
			
			angular.forEach(defPD, function(value, key) {
				montaColunas.push(DTColumnBuilder.newColumn(key).withTitle(value.tlt).withOption('visible', value.vsbl).withOption('sWidth', value.width));
			});
			
			$scope.dtColumns = montaColunas;
											
			angular.element('#listDocuments').attr('datatable', '');
			$compile(angular.element('#listDocuments'))($scope);

			$scope.dtOptions.withOption('fnRowCallback',
				
				function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
					//aData = JSON.parse(aData.jsonDocs)
					//console.log(JSON.parse(aData.jsonDocs))
					$compile(nRow)($scope);
			});

		}
			
		$scope.atualizaTabela();
		
		$scope.mostraTabelaCompleta = () => {
			$scope.atualizaTabela("completa"); 
		};

		$scope.mostraTabelaSimplificada = () =>{
			$scope.atualizaTabela();
		};

		$scope.removerDocumento = ($dados) =>{	
			var id = $dados.id;

			bootbox.confirm({
				message:'Confirma a exclusão do registro?',
				onHidden: function(e) {
					$scope.atualizaTabela();
    			},
				callback: function(confirmacao){

					if (confirmacao){
						$http.delete('/clicVendas/rest/pedidov2/deleta/'+id); 
						setTimeout(() => {$scope.atualizaTabela();}, 1000);
					}
				},
				buttons: {
					cancel: {label: 'Cancelar',className:'btn-default'},
					confirm: {label: 'Excluir',className:'btn_grid btn_cor_padrao'}
					
				}
			});
			 
		};
			
	});
</script> 
<!-- Regra de negócio -->


<script>
	/* Set the width of the sidebar to 250px and the left margin of the page content to 250px */
	function openNav() {
		if(document.getElementById("mySidebar").style.width =="250px"){
			document.getElementById("mySidebar").style.width = "0";
			document.getElementById("mySidebar").style.height = "0";
			document.getElementById("main").style.marginLeft = "0";
		  }else{
			document.getElementById("mySidebar").style.width = "250px";
			document.getElementById("mySidebar").style.height = "100%";
			document.getElementById("main").style.marginLeft = "250px";
		  }
		
	};

	/* Set the width of the sidebar to 0 and the left margin of the page content to 0 */
	
	/* activate scrollspy menu */
	var $body   = $(document.body);
	var navHeight = $('#mySideBar').outerHeight(true) + 10;

	$body.scrollspy({
		target: '#leftCol',
		offset: navHeight
	});
	
	function mostraCompleta() {
	  document.getElementById("tbSimplificada").style.visibility = "hidden";
	  document.getElementById("tbSimplificada").style.display = "none";
	  document.getElementById("tbCompleta").style.visibility = "visible";
	  document.getElementById("btnMostraTabela").setAttribute('onclick', "mostraSimplificada()");
	  document.getElementById("btnMostraTabela").innerText = 'Simplificada';;  
	};
	
	function mostraSimplificada() {
	  document.getElementById("tbSimplificada").style.visibility = "visible";
	  document.getElementById("tbSimplificada").style.display = "block";
	  document.getElementById("tbCompleta").style.visibility = "hidden";
	  document.getElementById("btnMostraTabela").setAttribute('onclick', "mostraCompleta()");
	  document.getElementById("btnMostraTabela").innerText = 'Completa';;  
	};
	</script>
<!-- Regra de negócio -->
</body>

</html>

<style>

:root {
		--cor_principal: #047cca;
	}
				
	.btn_grid{
		background-image: none !important;
		color: #fff !important;
		font-weight: 600;
	}

	.btn_acao_header{
		background-image: none !important;
		color: #fff !important;
		font-weight: 600;
		width: 80px;
		height: 35px;
		font-size: 0.88em;
	}

	.btn_cor_padrao {
		background-color: var(--cor_principal) !important;
		border-color: var(--cor_principal) !important; 
	}

	.container{
		flex:1;
		width: -webkit-fill-available;
	}

	.divider{
		border-top: 1px solid #bbb;
	}
	
	.divider-titulo{
		border-top: 0.8px solid #bbb;
		border-bottom: 0.8px solid #bbb;
		height: 50px;
		margin-top: 5px;
	}

	.spacer{
		margin-top:20px;
	}

	.titulo{
		font-size: 15px;
		font-weight: 900;
	}

	.vcenter {
		display: flex;
		align-items: center;
	}

	#mySidebar {
	  height: 100%; /* 100% Full-height */
	  width: 0; /* 0 width - change this with JavaScript */
	  position: absolute; /* Stay in place */
	  z-index: 1; /* Stay on top */
	  top: 50;
	  left: 50;
	  background-color: rgba(255, 255, 255, 1); 
	  overflow-x: hidden; /* Disable horizontal scroll */
	  padding-top: 60px; /* Place content 60px from the top */
	  transition: 0.5s; /* 0.5 second transition effect to slide in the sidebar */ 
	  box-shadow: 0 5px 5px 0 rgba(0,0,0,0.50);
  
	}


	#mySidebar a, label {
	  padding: 5px 5px 5px 10px;
	  text-decoration: none;
	  font-size: 14px;
	  color: #000;
	  display: block;
	  transition: 0.3s;
	  
	}
	
	#mySidebar input {
	  padding: 5px 5px 5px 10px;
	  margin-left: 10px;
	}

	.navbar-header, label {
	  display: inline !important
	}
	
	/* When you mouse over the navigation links, change their color */
	#mySidebar a:hover {
	  color: #000;
	}

	/* The button used to open the sidebar */
	.openbtn {
	  font-size: 20px;
	  cursor: pointer;
	  background-color: #111;
	  color: white;
	  padding: 10px 15px;
	  border: none;
	}

	.openbtn:hover {
	  background-color: #444;
	}

	/* Style page content - use this if you want to push the page content to the right when you open the side navigation */
	#main {
	  transition: margin-left .5s; /* If you want a transition effect */
	  padding: 0px;
	}

	/* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
	@media screen and (max-height: 450px) {
	  .sidebar {padding-top: 15px;}
	  .sidebar a {font-size: 18px;}
	}
	</style>