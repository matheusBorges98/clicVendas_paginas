<!DOCTYPE html>  
<html ng-app="appV2">  
<head> 
	<meta charset="utf 8">
	<script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.min.js"></script> 

	<!-- View -->
	<title>CXxxv</title>     
</head>  
<body>
	<div ng-controller="PedidoV2Ctrl">
		<div ng-repeat="doc in listaDocs">
			<div>{{doc.desPro}}</div>
		</div>
	</div>

	<h1 ng-controller="teste">{{message}}</h1>
	
	<!-- Regra de negócio -->
	<script type='text/javascript'>
		(function () {
			'use strict';
			angular
				.module("appV2", [])
				.controller("PedidoV2Ctrl", function($scope, $http, $rootScope) {  
					$scope.message2="Controller A";
					
					$scope.executaRequisicaoExterna = async ($json) => {
						try{
							let response = await $http.post(parent.dadosUserLogado().cContextIntegracao + '/rest/Listas/executarRequisicaoExterna', $json);
							
							return response.data;
						}catch(response){
							SrvMsg.geraMensagem("erro", "Não foi possível completar a requisição. Por favor, tente novamente mais tarde.");
						}
					};
					
					/*Irá retornar os documentos para o usuario - EX: Pedidos
						Funcionalidade: Chama 'executarRequisicaoExterna', passando o json esperado pela regra;
						------
						View: $scope.listaDocs - Listagem de documentos, EX: Pedidos
					*/
					const getListaDocumentos = async () =>{
						
						let result = await $scope.executaRequisicaoExterna(
						{
							idCvtccnpj	: parent.dadosUserLogado().cId,
							numreg		: 750, 
							pRotina		: "listarProdutoB2B",
							pCodCli     : parent.dadosUserLogado().rId,
							pNomPro     : "",
							pTipPro     : "",
						});

						$scope.listaDocs = result;
						$scope.$apply();
					};
					getListaDocumentos();
									
					console.log($scope.listaDocs);
				})
				.controller("teste", function($scope){
					$scope.message="Controller B" ;
				})
		})()
	</script> 

</body>  
</html>