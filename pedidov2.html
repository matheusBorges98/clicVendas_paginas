<style>
h3.h3{text-align:center;margin:1em;text-transform:capitalize;font-size:1.7em;}


.product-grid6,.product-grid6 .product-image6{overflow:hidden}
.product-grid6{font-family:'Open Sans',sans-serif;text-align:center;position:relative;transition:all .5s ease 0s}
.product-grid6:hover{box-shadow:0 0 10px rgba(0,0,0,.3)}
.product-grid6 .product-image6 a{display:block}
/*.product-grid6 .product-image6 img{width:100%;height:auto;transition:all .5s ease 0s}*/
.product-grid6 .product-image6 img{width:160px;height:auto;transition:all .5s ease 0s}
.product-grid6:hover .product-image6 img{transform:scale(1.1)}
.product-grid6 .product-content{padding:12px 12px 15px;transition:all .5s ease 0s}
.product-grid6:hover .product-content{opacity:0}
.product-grid6 .title{font-size:16px;font-weight:600;text-transform:capitalize;margin:0 0 10px;transition:all .3s ease 0s}
.product-grid6 .title a{color:#000}
.product-grid6 .title a:hover{color:#2e86de}
.product-grid6 .price{font-size:16px;font-weight:600;color:#2e86de}
.product-grid6 .price span{color:#999;font-size:15px;font-weight:400;text-decoration:line-through;margin-left:7px;display:inline-block}
.product-grid6 .social{background-color:#fff;width:100%;padding:0;margin:0;list-style:none;opacity:0;transform:translateX(-50%);position:absolute;bottom:-50%;left:50%;z-index:1;transition:all .5s ease 0s}
.product-grid6:hover .social{opacity:1;bottom:20px}
.product-grid6 .social li{display:inline-block}
.product-grid6 .social li a{color:#909090;font-size:16px;line-height:45px;text-align:center;height:45px;width:45px;margin:0 7px;border:1px solid #909090;border-radius:50px;display:block;position:relative;transition:all .3s ease-in-out}
.product-grid6 .social li a:hover{color:#fff;background-color:#2e86de;width:80px}
.product-grid6 .social li a:after,.product-grid6 .social li a:before{content:attr(data-tip);color:#fff;background-color:#2e86de;font-size:12px;letter-spacing:1px;line-height:20px;padding:1px 5px;border-radius:5px;white-space:nowrap;opacity:0;transform:translateX(-50%);position:absolute;left:50%;top:-30px}
.product-grid6 .social li a:after{content:'';height:15px;width:15px;border-radius:0;transform:translateX(-50%) rotate(45deg);top:-20px;z-index:-1}
.product-grid6 .social li a:hover:after,.product-grid6 .social li a:hover:before{opacity:1}
@media only screen and (max-width:990px){.product-grid6{margin-bottom:30px}}

.fixed-action-btn {
    position: fixed;
    right: 25px;
    top: 95px;
    padding-top: 0;
    margin-bottom: 0;
    z-index: 997;
	background: #002A4E; !important;
	color: #fff;
	border-radius: 50px;
    min-width: 10px;
    padding: 3px 7px;
    font-size: 12px;
    font-weight: 700;
    line-height: 1;
	text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
}

.modal {
  text-align: center;}
  
.dropdown.dropdown-lg .dropdown-menu {
    margin-top: -1px;
    padding: 6px 20px;
}
.input-group-btn .btn-group {
    display: flex !important;
}
.btn-group .btn {
    border-radius: 0;
    margin-left: -1px;
}
.btn-group .btn:last-child {
    border-top-right-radius: 4px;
    border-bottom-right-radius: 4px;
}
.btn-group .form-horizontal .btn[type="submit"] {
  border-top-left-radius: 4px;
  border-bottom-left-radius: 4px;
}
.form-horizontal .form-group {
    margin-left: 0;
    margin-right: 0;
}
.form-group .form-control:last-child {
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
}

@media screen and (min-width: 768px) { 
  .modal:before {
	display: inline-block;
	vertical-align: middle;
	content: " ";
	height: 100%;
  }
  
  #adv-search {
	width: 500px;
	margin: 0 auto;
  }
  
  .dropdown.dropdown-lg {
	position: static !important;
  }
  
  .dropdown.dropdown-lg .dropdown-menu {
	min-width: 500px;
  }

}

.modal-dialog {
  display: inline-block;
  text-align: left;
  vertical-align: middle;
}
	
.hover-div{
    margin:0 auto;
    max-width:350px;
    margin-top:30px;
    border:1px solid #ccc;
    position:relative;
    overflow:hidden;
}
.hover-div{
    
}
.hover-div img{
    width:100%;
     transition:all ease-in-out .5s;
}
.view-details{
     transition:all ease-in-out .5s;
     top:45%;
    left:32%;
    position:absolute;
    opacity:0;
}
.view-details h4{
    transition:all ease-in-out .2s;
    background-color:#3ad0fc;
    padding:12px 24px;
    color:#fff;
}
.view-details:hover h4{
    transition:all ease-in-out .2s;
    background-color:#0D1335;
    padding:12px 24px;
    color:#fff;
}

.hover-div:hover .view-details{
    transition:all ease-in-out .5s;
    opacity:1;
    color:#000;
    top:42%;
}
.hover-div:hover img{
    transition:all ease-in-out .5s;
    opacity:.6;
    transform: scale(1.2);
}

.product-info {
  padding: 18px 0 10px;
  text-align: center;
}


</style>


<div class="fixed-action-btn" id="chekOut-btn" style="display: none; !important">
      <a class="btn-floating btn-large green" style="width:80px;height:80px;" href="javascript:finalizarPedido();">
	    <i class="fa fa-shopping-basket white-text fa-1x" style="line-height:60px !important;font-size:3rem !important"><span class="badge" id="qtdTot" style="background: #f00; !important;">4</span></i>
      </a>
</div>

<div class="container">

	<div class="modal fade" id="mdCheckOut" role="dialog">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">

				<div class="modal-header">
					<h5 class="modal-title">Finalizar Compra</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
					  <span aria-hidden="true">&times;</span>
				    </button>
				</div>

				<div class="modal-body">	
					<div class="col-md-12">
						<div class="row scroll" id="dvProdutos">
							<table id="gridFim" class="display" style="width:100%">
								<thead>
								  <tr>
									<th class="col-md-2">Produto</th>
									<th class="col-md-4">Descrição</th>
									<th class="col-md-2">Quantidade</th>
									<th class="col-md-1">Preço</th>
									<th class="col-md-1">Total</th>
									<th class="col-md-1">&nbsp;</th>
								  </tr>
								</thead>
							</table>						
						</div>
					</div>

					<div class="col-md-4"><hr class="linhaSeparacao">
						<form class="form-horizontal" role="form">
						  <div class="form-group">
							<label for="filter">Data Entrega</label>
							<select id="dtEntrega" class="form-control">[DATA_ENTREGA]</select>
						  </div>
						</form>
					</div>
					<div class="col-md-4"><hr class="linhaSeparacao"><label>Quantidade Total:&nbsp;</label><span id="totVendaQtd">0,00</span></div>
					<div class="col-md-4"><hr class="linhaSeparacao"><label>Valor Total:&nbsp;</label><span id="totVendaFin">R$ 0,00</span></div>
				</div>	
				
			    <div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
					<button type="button" class="btn btn-success" data-dismiss="modal" onclick="fecharPedido()">Finalizar</button>
			    </div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="adicionarItem" tabindex="-1" role="dialog">
	  <div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title"><span id="tituloVenda"></span></h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
				  <span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div style="margin-top:15px;">
					<div class="row">
						<div class="col-md-2">
							<img id="imgVenda" style="max-height: 130px;" src="" onerror="this.src='/clicvenda/produtos/semimagem.png'">
						</div>
						<div class="col-md-7">	
							<div class="row" style="margin: 0px;">													
								<h5><span id="detalheVenda"></span></h5>
								<div>
									<p style="font-size:0.9em;" class="ng-binding">Código: <span id="codigoVenda"></span></p>
								</div>																		
							</div>
						</div>	
						
						<div class="col-md-3">	
							<img src="images/loader/ajax-loader-red.gif" style="width: 70px;" class="ng-hide" onerror="this.src='/clicvenda/produtos/semimagem.png'">
							<button class="btn btn-success" type="button" id="btn-adicionar" style="margin-right:auto;margin-left:auto;display:block;width:163px;" disabled="disabled" onclick="addCarrinho()">Adicionar ao Carrinho</button>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<table id="gridProduto" class="display" style="width:100%">
							<thead>
							  <tr>
								<th class="col-md-2">Produto</th>
								<th class="col-md-5">Descrição</th>
								<th class="col-md-2">Quantidade</th>
								<th class="col-md-1">Preço</th>
								<th class="col-md-1">Total</th>
							  </tr>
							</thead>
						</table>
					</div>
				</div>
			</div>

			<div class="row ng-scope" style="color:#585858;">
				<hr class="linhaSeparacao">
				<div class="col-md-6">&nbsp;</div>
				<div class="col-md-3"><h5 class="ng-binding">Nenhum produto selecionado</h5></div>
				<div class="col-md-3"><h5 class="ng-binding">Total: <span id="totVenda">R$ 0,00</span></h5></div>
			</div>
		</div>
	  </div>
	</div>
	
	<div id="modalImg" class="modal" tabindex="-1">
	  <span class="close">&times;</span>
	  <!-- Modal Content (The Image) -->
	  <img class="modal-content" id="img01" style="max-height: 400px;" onerror="this.src='/clicvenda/produtos/semimagem.png'">
	</div>
	
	<div class="modal fade" id="msgConfirma" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Mensagem</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
					  <span aria-hidden="true">&times;</span>
				    </button>
				</div>
				<div class="modal-body text-center" id="bodyMsg"></div>	
			    <div class="modal-footer">
					<button type="button" class="btn btn-primary btn_cor_padrao" data-dismiss="modal">Fechar</button>
			    </div>
			</div>
		</div>
	</div>

	<div class="panel-footer">
		<div class="row">
			<div class="col-md-12">
				<div class="input-group" id="adv-search">
					<input type="text" id="nomeProduto" class="form-control" placeholder="O que você esta procurando?" />
					<div class="input-group-btn">
						<div class="btn-group" role="group">
							<div class="dropdown dropdown-lg">
								<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></button>
								<div class="dropdown-menu dropdown-menu-right" role="menu">
									<form class="form-horizontal" role="form">
									  <div class="form-group">
										<label for="filter">Tipo de produto</label>
										<select id="tipoProduto" class="form-control">
											<option value="0" selected>Todos os tipos</option>
											[TIPO_PRODUTO]
										</select>
									  </div>
									</form>
								</div>
							</div>
							<button type="button" class="btn btn-primary" onclick="filtrarProduto()"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
						</div>
					</div>
				</div>
			  </div>
		 </div>
	</div>
    <div id="dvVitrine"></div>
</div>


<script type="text/javascript">

    $('a[data-toggle=\"tab\"]').on( 'shown.bs.tab', function (e) {
        $.fn.dataTable.tables( {visible: true, api: true} ).columns.adjust();
    } );

	var aProdutoSel = new Array();
	var aProdutoTmp = new Array();

	var gdrProduto = $("#gridProduto").DataTable({
							"paging": false, 
							"lengthChange": false,
							"pageLength": 3,
							"info": false,
							"searching": false,
							"scrollY": "170px",
							"scrollCollapse": true,
							"ordering": false,
							"autoWidth": false,
							"columns": [
								{ "data": "produto"},
								{ "data": "descricao"},
								{ "data": "quantidade"},
								{ "data": "preco"},
								{ "data": "total"}
							],
							"columnDefs":[
											{ 
												targets: [0],
												render: function(data, type, full, meta){
												   if(type === 'display'){
													  data = '<div style=\"text-align: center\"><img src=\"/clicvenda/produtos/portalrefriconalimentos/' + data + '.jpg\" onerror=\"this.src=\'/clicvenda/produtos/semimagem.png\'\" style=\"max-height: 60px;\" onclick=\"ampliarImagem(this)\"></div>';
												   }
												   return data;
												}
											},
											{ 
												targets: [2],
												render: function(data, type, full, meta){
												   if(type === 'display'){
													  data = '<div style=\"text-align: center\"><div class=\"input-group\"><span class=\"input-group-btn\"><button type=\"button\" class=\"btn btn-default btn-number\" name=\"' + full.produto + '\" onclick=\"removeItem(this)\"><span class=\"glyphicon glyphicon-minus\"></span></button></span><input type=\"number\" class=\"form-control input-number\" name=\"' + full.produto + '\" id=\"qtdPro' + full.produto + '\" value=\"' + full.quantidade + '\" onchange=\"validaItem(this)\"><span class=\"input-group-btn\"><button type=\"button\" class=\"btn btn-default btn-number\" name=\"' + full.produto + '\" onclick=\"addItem(this)\"><span class=\"glyphicon glyphicon-plus\"></span></button></span></div></div>';
												   }
												   return data;
												}
											},
											{ 
												targets: [3,4],
												render: function(data, type, full, meta){
												   if(type === 'display'){
													data = data;
													  data = data.formatMoney(2, "R$ ", ".", ",");
												   }
												   return data;
												}
											}
									]});
									
	var gdrFim = $("#gridFim").DataTable({
							"paging": false, 
							"lengthChange": false,
							"pageLength": 3,
							"info": false,
							"searching": false,
							"scrollY": "170px",
							"scrollCollapse": true,
							"ordering": false,
							"autoWidth": false,
							"columns": [
								{ "data": "produto"},
								{ "data": "descricao"},
								{ "data": "quantidade"},
								{ "data": "preco"},
								{ "data": "total"},
								{ "data": "excluir"}
							],
							"columnDefs":[
											{ 
												targets: [0],
												render: function(data, type, full, meta){
												   if(type === 'display'){
													  data = '<div style=\"text-align: center\"><img src=\"/clicvenda/produtos/portalrefriconalimentos/' + data + '.jpg\" onerror=\"this.src=\'/clicvenda/produtos/semimagem.png\'\" style=\"max-height: 60px;\" onclick=\"ampliarImagem(this)\"></div>';
												   }
												   return data;
												}
											},
											{ 
												targets: [2],
												render: function(data, type, full, meta){
												   if(type === 'display'){
													  data = '<div style=\"text-align: center\"><div class=\"input-group\"><span class=\"input-group-btn\"><button type=\"button\" class=\"btn btn-default btn-number\" name=\"' + full.produto + '\" onclick=\"removeItemCarrinho(this)\"><span class=\"glyphicon glyphicon-minus\"></span></button></span><input type=\"number\" class=\"form-control input-number\" name=\"' + full.produto + '\" id=\"qtdProCarrinho' + full.produto + '\" value=\"' + full.quantidade + '\" onchange=\"validaItemCarrinho(this)\"><span class=\"input-group-btn\"><button type=\"button\" class=\"btn btn-default btn-number\" name=\"' + full.produto + '\" onclick=\"addItemCarrinho(this)\"><span class=\"glyphicon glyphicon-plus\"></span></button></span></div></div>';
												   }
												   return data;
												}
											},
											{ 
												targets: [3,4],
												render: function(data, type, full, meta){
												   if(type === 'display'){
													  data = data.formatMoney(2, "R$ ", ".", ",");
												   }
												   return data;
												}
											}
											,
											{ 
												targets: [5],
												render: function(data, type, full, meta){
												   if(type === 'display'){
													  data = '<a href=\"javascript:excluirCarrinho(' + meta.row + ');\"><i class=\"fa fa-trash\"></i></a>';
												   }
												   return data;
												}
											}
									]});

		function listaProduto(filtro) {
		
			var parametros = {	idCvtccnpj	: dadosUserLogado().cId,
								numreg		: 750, 
								pRotina		: "listarProdutoB2B", 
								pCodCli     : [CODIGO_CLIENTE],
								pNomPro     : filtro.nome,
								pTipPro     : filtro.tipo
							};
							
			$.ajax({
				url: dadosUserLogado().cContextIntegracao + '/rest/Listas/executarRequisicaoExterna',
				type: "POST",
				data : JSON.stringify(parametros),
				success : function(response) {
				
					console.log(response);
				
					var objRetorno = JSON.parse(response);
					var vsVitrine = '';
					var vnQtdLin = 0;
					for ( var indice in objRetorno) {
					
						if (vnQtdLin == 0) vsVitrine = vsVitrine + '<div class=\"row\" style=\"padding-bottom:7px;padding-top:3px;\">';
					
						vsVitrine = vsVitrine + '<div class=\"col-md-3 col-sm-6\"> \
							<div class=\"product-grid6\"> \
								<div class=\"product-image6\"> \
									<a id=\"' + objRetorno[indice].codPro + '\" href=\"javascript:void(0)\" onclick=\"novaVenda(this.id);\"> \
										<img class=\"pic-1\" src=\"https://portalrefriconalimentos.clicvenda.com.br/clicvenda/produtos/portalrefriconalimentos/' + objRetorno[indice].codPro + '.jpg\" onerror=\"this.src=\'/clicvenda/produtos/semimagem.png\'\"> \
									</a> \
								</div> \
								<div class=\"product-content\"> \
									<h3 class=\"title\"><a href=\"#\">' + objRetorno[indice].desPro + '</a></h3> \
									<div class=\"price\"> R$ ' + objRetorno[indice].preBas + '</div> \
								</div> \
								<ul class=\"social\"> \
									<li><a id=\"' + objRetorno[indice].codPro + '\" href=\"javascript:void(0)\" onclick=\"novaVenda(this.id);\" data-tip=\"Adicionar ao carrinho\"><i class=\"fa fa-shopping-cart\"></i></a></li> \
								</ul> \
							</div> \
						</div>';
											
						vnQtdLin++;
						
						if (vnQtdLin == 4) vnQtdLin = 0;
						
						if (vnQtdLin == 0) vsVitrine = vsVitrine + '</div>';
					};
					
					if (vnQtdLin > 0) vsVitrine = vsVitrine + '</div>';
					
					document.getElementById("dvVitrine").innerHTML = vsVitrine;
				}, 
				beforeSend: function () {
					$("#loadingModal").modal({backdrop: 'static', keyboard: false});

				},
				complete: function () {
					$("#loadingModal").modal('hide');
				},
				error: function(response) {					
					alert(response);
				}	
			});	
		}
		
		
		function novaVenda(CodPro) {
					
			aProdutoTmp = [];

			var parametros = {	idCvtccnpj	: dadosUserLogado().cId,
								numreg		: 750, 
								pRotina		: "listarDerivacaoB2B", 
								pCodCli     : [CODIGO_CLIENTE],
								pCodPro     : CodPro
							};
			$.ajax({
				url: dadosUserLogado().cContextIntegracao + '/rest/Listas/executarRequisicaoExterna',
				type: "POST",
				data : JSON.stringify(parametros),
				success : function(response) {
				
					var objRetorno = JSON.parse(response);

					document.getElementById("tituloVenda").innerText = objRetorno.descricao;
					document.getElementById("detalheVenda").innerText = objRetorno.informacao;
					document.getElementById("codigoVenda").innerText = objRetorno.derivacao[0].produto ;
					
					
					document.getElementById("imgVenda").src = "/clicvenda/produtos/portalrefriconalimentos/" + objRetorno.derivacao[0].produto + ".jpg";

					for ( var indice in objRetorno.derivacao) {
						aProdutoTmp[indice] = objRetorno.derivacao[indice];
						aProdutoTmp[indice].quantidade = 0;	
						aProdutoTmp[indice].total = 0;
					}
					
					function atualizarGrid(){
						gdrProduto.clear();
						document.getElementById("totVenda").innerText = "R$ 0,00";
						gdrProduto.rows.add(aProdutoTmp).draw();
						gdrProduto.columns.adjust().draw();					
					}
					
					document.getElementById("btn-adicionar").disabled = true;
					
					$("#adicionarItem").modal();
					setTimeout(atualizarGrid, 300);
				}, 
				beforeSend: function () {
					$("#loadingModal").modal({backdrop: 'static', keyboard: false});

				},
				complete: function () {
					$("#loadingModal").modal('hide');
				},
				error: function(response) {					
					alert(response);
				}	
			});	
		}
		
	function removeItemCarrinho(oProduto) {
		var vCodPro = oProduto.name;
		var oQtd = document.getElementById("qtdProCarrinho" + vCodPro);
		var vValor = parseInt(oQtd.value) - 1;
		if (vValor < 0) vValor = 0;
		oQtd.value = vValor.toString();
		updateItemCarrinho(vCodPro);
	}
	
	function addItemCarrinho(oProduto) {
		var vCodPro = oProduto.name;
		var oQtd = document.getElementById("qtdProCarrinho" + vCodPro);
		var vValor = parseInt(oQtd.value) + 1;
		oQtd.value = vValor.toString();
		updateItemCarrinho(vCodPro);
	}	

	function validaItemCarrinho(oProduto) {
		var vCodPro = oProduto.name;
		var oQtd = document.getElementById("qtdProCarrinho" + vCodPro);
		var vValor = parseInt(oQtd.value);
		if (vValor<0) vValor = 0;
		oQtd.value = vValor.toString();
		updateItemCarrinho(vCodPro);
	}
	
	function removeItem(oProduto) {
		var vCodPro = oProduto.name;
		var oQtd = document.getElementById("qtdPro" + vCodPro);
		var vValor = parseInt(oQtd.value) - 1;
		if (vValor < 0) vValor = 0;
		oQtd.value = vValor.toString();
		updateItem(vCodPro);
	}
	
	function addItem(oProduto) {
		var vCodPro = oProduto.name;
		var oQtd = document.getElementById("qtdPro" + vCodPro);
		var vValor = parseInt(oQtd.value) + 1;
		oQtd.value = vValor.toString();
		updateItem(vCodPro);
	}
	
	function validaItem(oProduto) {
		var vCodPro = oProduto.name;
		var oQtd = document.getElementById("qtdPro" + vCodPro);
		var vValor = parseInt(oQtd.value);
		if (vValor<0) vValor = 0;
		oQtd.value = vValor.toString();
		updateItem(vCodPro);
	}
	
	function updateItemCarrinho(vCodPro) {
		var oQtd = document.getElementById("qtdProCarrinho" + vCodPro);
		
		if ((oQtd.value=="") || (oQtd.value=="0")){
			oQtd.value="1";
		}
		
		var vValor = parseInt(oQtd.value);
		var vIndice = -1;
		
		for ( var indice in aProdutoSel) {
			if (aProdutoSel[indice].produto == vCodPro){
				vIndice = indice; 
			}
		}
		
		aProdutoSel[vIndice].quantidade =  vValor;
		oQtd.value = vValor.toString();
		
		var vTotalVenda = 0;
		var vQtdTotVenda = 0;
		
		for ( var indice in aProdutoSel) {
			if (aProdutoSel[indice].produto == vCodPro){
				aProdutoSel[indice].quantidade = vValor;
				aProdutoSel[indice].total = vValor * aProdutoSel[indice].preco;
			}
			vTotalVenda = vTotalVenda + (aProdutoSel[indice].quantidade  * aProdutoSel[indice].preco);
			vQtdTotVenda = vQtdTotVenda + aProdutoSel[indice].quantidade;
		}
		
		document.getElementById("totVendaFin").innerText = vTotalVenda.formatMoney(2, "R$ ", ".", ",");
		document.getElementById("totVendaQtd").innerText = vQtdTotVenda.formatMoney(2, " ", ".", ",");
		
		localStorage.setItem('carClic', JSON.stringify(aProdutoSel));
		
		document.getElementById("qtdTot").innerText = aProdutoSel.length.toString();
		if (aProdutoSel.length > 0) document.getElementById("chekOut-btn").style.setProperty("display", "inline-block");
		
	    /*gdrFim.clear();
	    gdrFim.rows.add(aProdutoSel).draw();
	    gdrFim.columns.adjust().draw();*/
		
	}
	
	function updateItem(vCodPro) {
		var oQtd = document.getElementById("qtdPro" + vCodPro);
		
		if (oQtd.value=="") {
			oQtd.value="0";
		}
		
		var vValor = parseInt(oQtd.value);
		var vIndice = -1;		
		oQtd.value = vValor.toString();
		
		var vTotalVenda = 0;
		
		for ( var indice in aProdutoTmp) {
			if (aProdutoTmp[indice].produto == vCodPro){
				aProdutoTmp[indice].quantidade = vValor;
				aProdutoTmp[indice].total = vValor * aProdutoTmp[indice].preco;
				
				/*if ((vValor>0) && (vIndice==-1)) {
				  aProdutoSel[aProdutoSel.length] = aProdutoTmp[indice];
				}*/
			}
			vTotalVenda = vTotalVenda + (aProdutoTmp[indice].quantidade  * aProdutoTmp[indice].preco);
		}
		
		document.getElementById("totVenda").innerText = vTotalVenda.formatMoney(2, "R$ ", ".", ",");
		
	    if (vTotalVenda > 0) 
		   document.getElementById("btn-adicionar").disabled = false;
		else
		   document.getElementById("btn-adicionar").disabled = true;
		   
		/*gdrProduto.clear();
		gdrProduto.rows.add(aProdutoTmp).draw();
		gdrProduto.columns.adjust().draw();*/
	}
	
	function addCarrinho() {
	
		var vIndSel = -1;
	
		for ( var indiceTmp in aProdutoTmp) {
		    
			if (aProdutoTmp[indiceTmp].quantidade > 0) {
				vIndSel = -1;
				
				for ( var indiceSel in aProdutoSel) {
					if (aProdutoSel[indiceSel].produto == aProdutoTmp[indiceTmp].produto){
						vIndSel = indiceSel;
					}
				}
				
				if (vIndSel == -1)
				  aProdutoSel[aProdutoSel.length] = aProdutoTmp[indiceTmp];
				else
				  aProdutoSel[vIndSel] = aProdutoTmp[indiceTmp];
			}
		}
		
		localStorage.setItem('carClic', JSON.stringify(aProdutoSel));
	
		document.getElementById("qtdTot").innerText = aProdutoSel.length.toString();
		if (aProdutoSel.length > 0) document.getElementById("chekOut-btn").style.setProperty("display", "inline-block");
		$("#adicionarItem").modal('hide');	
	}
	
	function ampliarImagem(oImagem) {
		var imgZoon = document.getElementById("img01");
		imgZoon.src = oImagem.src;
		$("#modalImg").modal();
	}
	
	function fecharPedido() {
	
	
			var parametros = {	idCvtccnpj	: dadosUserLogado().cId,
								numreg		: 750, 
								pRotina		: "fecharPedidoB2B", 
								pCodCli     : [CODIGO_CLIENTE],
								pItem     : JSON.stringify(aProdutoSel),
								pDatEnt   : document.getElementById("dtEntrega").value
							};
							
			$.ajax({
				url: dadosUserLogado().cContextIntegracao + '/rest/Listas/executarRequisicaoExterna',
				type: "POST",
				data : JSON.stringify(parametros),
				success : function(response) {

					if(response.indexOf('ERRO') == -1){
						aProdutoSel = [];
						localStorage.setItem('carClic', JSON.stringify(aProdutoSel));
						document.getElementById("chekOut-btn").style.setProperty("display", "none");
					}
					
					var vBodyMsg = document.getElementById("bodyMsg");
					vBodyMsg.innerHTML =  "<i class=\"glyphicon glyphicon-ok\" style=\"font-size: 2.5em;color: #002A4E;!important;\"></i><br>" + response;
					$("#msgConfirma").modal();
					
				}, 
				beforeSend: function () {
					$("#loadingModal").modal({backdrop: 'static', keyboard: false});

				},
				complete: function () {
					$("#loadingModal").modal('hide');
				},
				error: function(response) {					
					alert(response);
				}	
			});	
	}
	
	function finalizarPedido() {
	
		var vTotalVenda = 0;
		var vQdTotVenda = 0;
	
		for ( var indice in aProdutoSel) {
		  aProdutoSel[indice].excluir = aProdutoSel[indice].produto;
		  vTotalVenda = vTotalVenda + (aProdutoSel[indice].quantidade  * aProdutoSel[indice].preco);
		  vQdTotVenda = vQdTotVenda + aProdutoSel[indice].quantidade;
		}
		
		document.getElementById("totVendaFin").innerText = vTotalVenda.formatMoney(2, "R$ ", ".", ",");
		document.getElementById("totVendaQtd").innerText = vQdTotVenda.formatMoney(2, " ", ".", ",");

		$('#mdCheckOut').modal();
		
		function atualizarGrid(){
			gdrFim.clear();
			gdrFim.rows.add(aProdutoSel).draw();
			gdrFim.columns.adjust().draw();
		}
		setTimeout(atualizarGrid, 300);
	}

	function excluirCarrinho(vIndice) {
	  aProdutoSel.splice(vIndice, 1);
	  document.getElementById("qtdTot").innerText = aProdutoSel.length.toString();
	  if (aProdutoSel.length > 0) {
	  
	    var vTotalVenda = 0;
		var vQtdTotVenda = 0;
		 
		for ( var indice in aProdutoSel) {
			vTotalVenda = vTotalVenda + (aProdutoSel[indice].quantidade  * aProdutoSel[indice].preco);
			vQtdTotVenda = vQtdTotVenda + aProdutoSel[indice].quantidade;
		}
		
		document.getElementById("totVendaFin").innerText = vTotalVenda.formatMoney(2, "R$ ", ".", ",");
		document.getElementById("totVendaQtd").innerText = vQtdTotVenda.formatMoney(2, " ", ".", ",");
		  
		gdrFim.clear();
		gdrFim.rows.add(aProdutoSel).draw();
		gdrFim.columns.adjust().draw();
	  }
	  else {
		document.getElementById("chekOut-btn").style.setProperty("display", "none");
		$("#mdCheckOut").modal('hide');
	  }
	  
	  localStorage.setItem('carClic', JSON.stringify(aProdutoSel));
	}
	
		Number.prototype.formatMoney = function(places, symbol, thousand, decimal) {
			places = !isNaN(places = Math.abs(places)) ? places : 2;
			symbol = symbol !== undefined ? symbol : "$";
			thousand = thousand || ",";
			decimal = decimal || ".";
			var number = this, 
				negative = number < 0 ? "-" : "",
				i = parseInt(number = Math.abs(+number || 0).toFixed(places), 10) + "",
				j = (j = i.length) > 3 ? j % 3 : 0;
			return symbol + negative + (j ? i.substr(0, j) + thousand : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thousand) + (places ? decimal + Math.abs(number - i).toFixed(places).slice(2) : "");
		};

     var oFiltro = {nome:" ",tipo:0};
	 var vaValor = localStorage.getItem('carClic');
	 if (vaValor==null){
	   aProdutoSel = [];
	 }
	 else {
	   aProdutoSel = JSON.parse(vaValor);
	   
	   if (aProdutoSel.length > 0) {
		  document.getElementById("qtdTot").innerText = aProdutoSel.length.toString();
		  document.getElementById("chekOut-btn").style.setProperty("display", "inline-block");
	   }
	 }
	 
	 
	var vNrReady = 0;
	 
	listaProduto(oFiltro);

	 
	 function filtrarProduto(){
	    oFiltro.nome = document.getElementById("nomeProduto").value;
		oFiltro.tipo = document.getElementById("tipoProduto").value;
		listaProduto(oFiltro);
	 }
	 
</script>