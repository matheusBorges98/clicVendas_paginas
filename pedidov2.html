<!DOCTYPE html>  
<html ng-app="appV2">  
<head> 
	<meta charset="utf-8"/>
	<!-- Imports CSS-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/jquery.dataTables.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/angular-datatables.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/dataTables.colVis.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/dataTables.tableTools.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/buttons.dataTables.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/datatables.bootstrap.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/isteven-multi-select.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/font-awesome/css/all.min.css">
	<link rel="stylesheet" href="http://sistema.clicvenda.com.br/clicVendas/plugins/angCSS/buttons.dataTables.min.css">
	<!-- Imports CSS-->

<!-- View --> 
</head>  
<body>
	<div class="container" ng-controller="MainController">

		<div ng-show="exibeListaDocumentos">

			<!-- Static navbar -->
			<nav class="navbar navbar-default" id="myNavbar" role="navigation">
				<div class="container-fluid">
					<div class="navbar-header">
						<button class="btn btn-default navbar-btn" id="myCBTN" onclick="openNav()">&#9776;</button>
					</div>
					
					<div id="navbar" class="navbar-collapse collapse">
						<form class="navbar-form navbar-left" role="search">
							<div class="form-group">
								<input type="text" class="form-control" placeholder="Search">
							</div>
							<button type="submit" class="btn btn-default">Submit</button>
						</form>
						<button class="btn btn-default navbar-btn" >Adicionar</button>
						<ul class="nav navbar-nav navbar-right">
							<button id="btnMostraTabela" style="visibility: visible;" text="" class="btn btn-default navbar-btn" onclick="mostraCompleta()">Detalhada</button>
						</ul>
					</div><!--/.nav-collapse -->
				</div><!--/.container-fluid -->
			</nav>

			<!-- Sidebar Menu FILTRO -->
			<div id="mySidebar" class="sidebar">
				<form>
					<div class="form-group">
						<label for="filFornecedores">Fornecedor</label>
						<input type="text" style="width: 220px;" class="form-control" id="filFornecedores" ng-model="filFornecedores" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCliente">Cliente</label>
						<input type="text" style="width: 220px;" class="form-control" id="filCliente" ng-model="filCliente" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filBU">BU</label>
						<input type="text" style="width: 220px;" class="form-control" id="filBU" ng-model="filBU" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCluster">Cluster</label>
						<input type="text" style="width: 220px;" class="form-control" id="filCluster" ng-model="filCluster" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filStatusAmostra">Status da Amostra</label>
						<input type="text" style="width: 220px;" class="form-control" id="filStatusAmostra" ng-model="filStatusAmostra" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Carteira</label>
						<input type="text" style="width: 220px;" class="form-control" id="filCarteira" ng-model="filCarteira" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Data Envio</label>
						<input type="text" style="width: 75px;" class="form-control" id="filDataEnvio" ng-model="filDataEnvio" aria-describedby=" " placeholder="In�cio">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Data Solicitação</label>
						<input type="text" style="width: 75px;" class="form-control" id="filDataSolicitacao" ng-model="filDataSolicitacao" aria-describedby=" " placeholder="Fim">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Segmento</label>
						<input type="text" style="width: 220px;" class="form-control" id="filSegmento" ng-model="filSegmento" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">SubSegmento</label>
						<input type="text" style="width: 220px;" class="form-control" id="filSubSegmento" ng-model="filSubSegmento" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Prioridade</label>
						<input type="text" style="width: 220px;" class="form-control" id="filPrioridade" ng-model="filPrioridade" aria-describedby=" " placeholder=" ">
					</div>
					
					<div class="form-group">
						<label for="filCarteira">Produto</label>
						<input type="text" style="width: 220px;" class="form-control" id="filProduto" ng-model="filProduto" aria-describedby=" " placeholder=" ">
					</div>
				</form>
			</div>

			<!-- Tabela -->
			<div id="main">
				<div class="col-md-12">
					
					<div id="tbSimplificada" style="visibility: visible;" class="table-responsive">
						
						<table id="listaDocumentos"  dt-options="dtOptions" dt-columns="dtColumns" dt-instance="dtInstance" class="row-border hover table-striped table-bordered"/>					
					
				</div>
			</div>
		

		
		</div>
		
		<!-- FORM NOVO DOCUMENTO -->

		<div ng-show="exibeFormulario" class="container col-sm-12">
			<button class="btn btn_acao_header btn_cor_padrao" ng-click="listarDocumentos()"> Voltar </button>

			<!-- Header formulario -->
			<div class="divider-titulo col-sm-12">
				<div class="spacer titulo vcenter">
					Novo pedido
				</div>			
			</div>
			<!-- Header formulario -->
			
			<!-- Capa do pedido -->
			<div class="row spacer">
				
					

			</div>
						
			<hr class="divider">
			<!-- Ações sob o formulario -->
			<div class="row spacer">
				<div class="pull-right" style="padding-right: 10px;">
					<div class="btn-group">
						<button class="btn btn_grid btn_cor_padrao" ng-click="listarDocumentos()"> Cancelar </button>
					</div>
					<div class="btn-group">
						<button class="btn btn_grid btn_cor_padrao" ng-click="salvarForm()"> Salvar </button>
					</div>	
				</div>
			</div>
			<hr class="divider">	

		</div>
	</div>
	<!-- View --> 
	</div>

<!-- Scripts importados -->
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/jquery-3.1.1.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/easytimer.min.js"></script>	
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-route.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-ui-router.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-cookies.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angular-ui-notification/angular-ui-notification.min.js"></script>  
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/ui-bootstrap-tpls-2.5.0.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/dist/jquery.dataTables.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/dist/angular-datatables.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/bootstrap.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.bootstrap.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.factory.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.options.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/dataTables.buttons.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.colVis.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.flash.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.html5.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/buttons.print.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-datatables.buttons.min.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-locale_pt-br.js"></script>
	<script src="http://sistema.clicvenda.com.br/clicVendas/plugins/angJS/angular-sanitize.min.js"></script>
<!-- Scripts importados -->	

<script>
var dadosUserLogado = parent.dadosUserLogado();	

angular
	.module("appV2",['ngRoute', 'ngSanitize', 'ui.bootstrap', 'datatables', 'datatables.buttons'])
	.controller("MainController",
	function(DTOptionsBuilder, DTColumnDefBuilder, DTColumnBuilder, DTDefaultOptions, $scope, $rootScope, $compile, $http, $timeout, $window){
		
		$rootScope.exibeFormulario 		= false; 
		$rootScope.exibeListaDocumentos = true; 

		console.log($rootScope.exibeFormulario, $rootScope.exibeListaDocumentos);

		$rootScope.listarDocumentos = () => {
			$rootScope.exibeListaDocumentos = true;
			$rootScope.exibeFormulario 		= false;

			$scope.$apply();
		};

		$rootScope.abreFormulario = () =>{
			$rootScope.exibeFormulario = true;
			$rootScope.exibeListaDocumentos = false;

			$scope.$apply();
		};
						
		$scope.executaRequisicaoExterna = async ($json) => {
			try{
				let response = await $http.post(dadosUserLogado.cContextIntegracao + '/rest/Listas/executarRequisicaoExterna', $json);
				
				return response.data;
			}catch(response){
				console.log("erro", "Não foi possível completar a requisição. Por favor, tente novamente mais tarde.");
			}
		};
		
		$scope.getListaDocumentos = async () =>{
			let result = await $scope.executaRequisicaoExterna(
			{
				idCvtccnpj	: dadosUserLogado.cId,
				numreg		: 750, 
				pRotina		: "listarProdutoB2B",
				pCodCli     : dadosUserLogado.rId,
				pNomPro     : "",
				pTipPro     : "",
			});

			console.log(result);
			$scope.listaDocs = result;
			$scope.$apply();
		};

		$scope.salvarDocumento = async () => {
			
			let id 			= 1;
			let itemDoc		= {};
			let dados 		= {};

			try{
				let response = await $http.post('clicVendas/rest/pedidov2/salvar', id, dados);

			}catch(err){
				console.log(err);
			}
		
		};

		/*Define o idioma usado no Datatables*/
		DTDefaultOptions.setLanguageSource('plugins/pt-br.json');
			
		var idGridDB = 3; /* Código Cadastro Grid banco */
		$http({
			url: '/clicVendas/rest/Listas/listaColunasGrid',
			method: 'POST',
			data : {cId : dadosUserLogado.cId, idGrid : idGridDB} 	
		}).then(function(response) {

			$scope.dtOptions = DTOptionsBuilder.newOptions()            
			.withOption('ajax', {
				url		: '/clicVendas/rest/pedido/lista',
				type	: 'POST',
				data	: function(d) {
							var	parametros = {
								idGrid : idGridDB
							};
							d.parametros = parametros;
							
							var filtros = {
									dtEmissaoInicio			: ((angular.isUndefined($rootScope.dtEmissaoInicio) || $rootScope.dtEmissaoInicio == null)?"":$rootScope.dtEmissaoInicio.toLocaleDateString()),
									dtEmissaoFim			: ((angular.isUndefined($rootScope.dtEmissaoFim) || $rootScope.dtEmissaoFim == null)?"":$rootScope.dtEmissaoFim.toLocaleDateString()),
									dtPrevisaoInicio		: ((angular.isUndefined($rootScope.dtPrevisaoInicio) || $rootScope.dtPrevisaoInicio == null)?"":$rootScope.dtPrevisaoInicio.toLocaleDateString()),
									dtPrevisaoFim 			: ((angular.isUndefined($rootScope.dtPrevisaoFim) || $rootScope.dtPrevisaoFim == null)?"":$rootScope.dtPrevisaoFim.toLocaleDateString()),
									idCvtccnpj 				: (angular.isUndefined(dadosUserLogado.cId)?0:dadosUserLogado.cId),
									rId 					: dadosUserLogado.rId,
									rTipoId 				: dadosUserLogado.rTipoId,
									listaStatusPed		  	: $rootScope.statusPedSel,
									listaFilSincronizacao	: $rootScope.filSincronizacaoSel,
									listaTipoPed			: $rootScope.tipoPedSel,
									filEhOrcamento			: $rootScope.filEhOrcamento,
									listaFiltroRamoAtividade: $rootScope.filRamoAtividade,	
									listaFiltroOrigem		: $rootScope.filOrigem	
							};
							d.filtros = filtros;
							return JSON.stringify(d);
						}
					})
					.withDataProp('data')
					.withOption('processing', true)
					.withOption('serverSide', true)
					.withOption('searchDelay', 1000)
					.withOption('scrollY', "100%")            
					.withPaginationType('full_numbers')            
					.withDisplayLength(20)
					.withDOM(`<'toolbar'>ftrip`)
					.withButtons([
				{
					enabled: dadosUserLogado.params.paramPermiteCadastrarPedido == 'S',
					text: 'Novo',
					key: '1',
					className: 'btn_grid btn_cor_padrao',
					action: function (e, dt, node, config) {									
						$rootScope.abreFormulario();					
					}
				},							
			]);	

			var montaColunas = response.data.columns;									
			$scope.dtColumns = montaColunas;

			/* Personalizar as Colunas */
			angular.forEach($scope.dtColumns, function (item,index){								
				switch (item.data) {
									
					case 'tipoVenda':						
						montaColunas[index].mRender		= function(data, type, row) {return (row.tipoVenda != null)?row.tipoVenda.tipoVenda:""};						
					break;
					
					case 'dataEmissao':						
						montaColunas[index].mRender		= function(data, type, row) {return row.dataEmissaoFormat};			
					break;
					
					case 'previsaoEntrega':						
						montaColunas[index].mRender		= function(data, type, row) {return row.previsaoEntregaFormat};	
					break;
					
					case 'totalVenda':						
						montaColunas[index].mRender		= function(data, type, row) {return row.totalVendaFormat};
					break;

					case 'origem':						
						montaColunas[index].mRender		= function(data, type, row) {return row.origem};
					break;

					case 'ramoAtividade':						
						montaColunas[index].mRender		= function(data, type, row) {return row.ramoAtividade};
					break;

					default:
				}
			});
			
			$scope.dtOptions.withOption('order', response.data.order);	
											
			angular.element('#listaDocumentos').attr('datatable', '');
			$compile(angular.element('#listaDocumentos'))($scope);
			
			$scope.dtOptions.withOption('fnRowCallback',
				function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
					$compile(nRow)($scope);
			});		
			
		});
		
	});
</script> 
<!-- Regra de negócio -->


<script>
	/* Set the width of the sidebar to 250px and the left margin of the page content to 250px */
	function openNav() {
	  document.getElementById("mySidebar").style.width = "250px";
	  document.getElementById("main").style.marginLeft = "250px";
	  document.getElementById("myCBTN").setAttribute('onclick', "closeNav()");
	};

	/* Set the width of the sidebar to 0 and the left margin of the page content to 0 */
	function closeNav() {
	  document.getElementById("mySidebar").style.width = "0";
	  document.getElementById("main").style.marginLeft = "0";
	  document.getElementById("myCBTN").setAttribute('onclick', "openNav()");
	};
	
	$(document).ready(function(){
		$("#mytable #checkall").click(function () {
			if ($("#mytable #checkall").is(':checked')) {
				$("#mytable input[type=checkbox]").each(function () {
					$(this).prop("checked", true);
				});

			} else {
				$("#mytable input[type=checkbox]").each(function () {
					$(this).prop("checked", false);
				});
			}
		});
    
	});
	
	/* activate scrollspy menu */
	var $body   = $(document.body);
	var navHeight = $('#mySideBar').outerHeight(true) + 10;

	$body.scrollspy({
		target: '#leftCol',
		offset: navHeight
	});
	
	function mostraCompleta() {
	  document.getElementById("tbSimplificada").style.visibility = "hidden";
	  document.getElementById("tbSimplificada").style.display = "none";
	  document.getElementById("tbCompleta").style.visibility = "visible";
	  document.getElementById("btnMostraTabela").setAttribute('onclick', "mostraSimplificada()");
	  document.getElementById("btnMostraTabela").innerText = 'Simplificada';;  
	};
	
	function mostraSimplificada() {
	  document.getElementById("tbSimplificada").style.visibility = "visible";
	  document.getElementById("tbSimplificada").style.display = "block";
	  document.getElementById("tbCompleta").style.visibility = "hidden";
	  document.getElementById("btnMostraTabela").setAttribute('onclick', "mostraCompleta()");
	  document.getElementById("btnMostraTabela").innerText = 'Completa';;  
	};
	</script>
<!-- Regra de negócio -->
</body>  
</html>


				
<style>

:root {
		--cor_principal: #047cca;
	}
				
	.btn_grid{
		background-image: none !important;
		color: #fff !important;
		font-weight: 600;
	}

	.btn_acao_header{
		background-image: none !important;
		color: #fff !important;
		font-weight: 600;
		width: 80px;
		height: 35px;
		font-size: 0.88em;
	}

	.btn_cor_padrao {
		background-color: var(--cor_principal) !important;
		border-color: var(--cor_principal) !important; 
	}

	.container{
		height: calc(100% - 40px); 
		position: relative;
	}

	.divider{
		border-top: 1px solid #bbb;
	}
	
	.divider-titulo{
		border-top: 0.8px solid #bbb;
		border-bottom: 0.8px solid #bbb;
		height: 50px;
		margin-top: 5px;
	}

	.spacer{
		margin-top:20px;
	}

	.titulo{
		font-size: 15px;
		font-weight: 900;
	}

	.vcenter {
		display: flex;
		align-items: center;
	}

	#mySidebar {
	  height: 100%; /* 100% Full-height */
	  width: 0; /* 0 width - change this with JavaScript */
	  position: absolute; /* Stay in place */
	  z-index: 1; /* Stay on top */
	  top: 50;
	  left: 50;
	  background-color: rgba(255, 255, 255, 1); 
	  overflow-x: hidden; /* Disable horizontal scroll */
	  overflow-y: hidden; /* Disable vertical scroll */
	  padding-top: 60px; /* Place content 60px from the top */
	  transition: 0.5s; /* 0.5 second transition effect to slide in the sidebar */ 
	  box-shadow: 0 5px 5px 0 rgba(0,0,0,0.50);
  
	}


	#mySidebar a, label {
	  padding: 5px 5px 5px 10px;
	  text-decoration: none;
	  font-size: 14px;
	  color: #000;
	  display: block;
	  transition: 0.3s;
	  
	}
	
	#mySidebar input {
	  padding: 5px 5px 5px 10px;
	  margin-left: 10px;
	}

	.navbar-header, label {
	  display: inline !important
	}
	
	/* When you mouse over the navigation links, change their color */
	#mySidebar a:hover {
	  color: #000;
	}

	/* The button used to open the sidebar */
	.openbtn {
	  font-size: 20px;
	  cursor: pointer;
	  background-color: #111;
	  color: white;
	  padding: 10px 15px;
	  border: none;
	}

	.openbtn:hover {
	  background-color: #444;
	}

	/* Style page content - use this if you want to push the page content to the right when you open the side navigation */
	#main {
	  transition: margin-left .5s; /* If you want a transition effect */
	  padding: 0px;
	}

	/* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
	@media screen and (max-height: 450px) {
	  .sidebar {padding-top: 15px;}
	  .sidebar a {font-size: 18px;}
	}
	</style>